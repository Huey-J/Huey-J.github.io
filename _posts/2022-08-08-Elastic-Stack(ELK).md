---
title: Elastic Stack (ELK)
author: Huey-J
date: 2022-08-08 12:00:00 +0800
categories: [데브옵스, 네트워크]
tags: [AWS, DevOps]
---

# 로그 모니터링

운영환경에 애플리케이션을 배포하고 서비스를 운영하다 보면 경험해보지 못한 오류와 마주치곤 한다.
우리는 이러한 상황에서 보다 효율적으로 오류를 분석하고 대응하기 위해 '로그'를 남겨 놓는다.

> 서버 로그 예시
몇시 몇분 몇초, 어떤 요청(트래픽)에 의해 OO메소드가 실행되었고 다음과 같은 오류가 발생하여 이러한 응답을 하였다.

로그를 남기는 방법 또한 다양하다. 시스템 로컬에 파일로 남기거나 특정 로그 서버를 설정하여 여러 대의 서버 로그를 한곳에서 볼 수도 있다.

분석하기 더 쉽게, 간결하지만 필요한 데이터로 구성하여 '잘 남기는 것'도 분명 중요하다.
하지만 남기기만 하는 것으로 끝일까?

로그를 남기는 이유 중 가장 큰 이유는 '나중에 보기 위해서'이다.

우리의 어플리케이션은 로그를 남긴다. 이를 통해 분석이 가능하다.
필자가 주로 사용하는 스프링의 로그는 이렇게 생겼다.
텍스트 그 자체로 분석할 수 있겠지만 로그가 쌓이고 종류가 다양해지면서 이 상태로 분석하는 것은 거의 불가능에 가깝다.
따라서 우리는 로그 파일을 모니터링할 수 있는 솔루션이 필요하였고 그중 가장 흔하게 사용되는 것이 바로 오늘 알아볼 Elastic Stack이다.



문제가 발생하면 가장 먼저 해야 할 게 무엇일까? 입이 닳도록 아깝지 않을 정도로 ‘로그’를 먼저 봐야 한다고 말하고 싶다.
만약 재부팅을 하더라도 문제 되고 있는 현재 시스템 상태의 로그를 남겨두고 (java에서는 heap/thread dump 등) 재부팅을 한다거나 하는 습관.
개발을 아무리 잘해도, 테스트 코드 작성을 아무리 잘해도 ‘로그’와 ‘모니터링’을 빼놓고선 서비스 운영을 논할 수 없기에 꼭 다양한 연습으로 습관화하는 게 필요할 것 같다.


# ELK

> 비슷한 종류로 Splunk가 있다.
> Splunk는 우수한 사용자 인터페이스를 갖춘 보다 편리한 솔루션이지만 사용자 라이선스를 구입하는 데 비용이 많이 든다.
> Elastic Stack의 데이터 시각화는 초기 설정에 있어 Splunk보다 덜 편리하지만 오픈 소스이기이지만, 사용자 라이선스 비용이 없다는 점이 강점이다.
> Splunk와 ELK 간의 처리 능력과 기능은 비슷하다. ELK는 구현 프로세스 초기에 설정하는 데 더 많은 작업과 계획이 필요하지만 초기 설정 이후로는 ELK의 데이터 추출 및 시각화는 Splunk보다 사용자 친화적이다.
> https://velog.io/@jkim2791/Splunk-vs.-ELK-Stack-Log-분석툴의-최강자는-누구일까

ELK란 Elasticsearch, Logstash, Kibana의 세 가지 인기 있는 프로젝트로 구성된 스택을 의미하는 약자입니다.
모니터링 서비스에서 가장 많이 사용되는 방법 중 하나이며 사용자에게 모든 시스템과 애플리케이션에서 로그를 집계하고 이를 분석하며 애플리케이션과 인프라 모니터링 시각화를 생성하고, 빠르게 문제를 해결하며 보안 분석할 수 있는 능력을 제공합니다.
또한 ELK는 오픈소스로, 무료로 사용이 가능합니다.

일래스틱서치는 로그스태시(Logstash)라는 이름의 데이터 수집 및 로그 파싱 엔진, 그리고 키바나(Kibana)라는 이름의 분석 및 시각화 플랫폼과 함께 개발되어 있다.
Elasticsearch는 검색 및 분석 엔진입니다.
Logstash는 여러 소스에서 동시에 데이터를 수집하여 변환한 후 Elasticsearch 같은 “stash”로 전송하는 서버 사이드 데이터 처리 파이프라인입니다.
Kibana는 사용자가 Elasticsearch에서 차트와 그래프를 이용해 데이터를 시각화할 수 있게 해줍니다.
https://www.elastic.co/kr/what-is/elk-stack


## Elastic Search

Elastic Search는 사실 로그 분석용 도구는 아닙니다. 성능 짱짱인 랭킹 1위 검색엔진이죠.
하지만 그만큼 성능과 확장성이 검증되었기 때문에 로그 모니터링에서의 검색엔진으로써도 활용되고 있습니다.

Elastic search는 [아파치 루씬](#apache-lucene) 기반의 검색 및 분석 엔진입니다. 그리고 이 검색 엔진은 저장된 데이터 로그를 검색하고 분석하는데 쓰입니다.
자바, 닷넷(C#), PHP, 파이썬 등 수많은 언어로 이용이 가능하며 오픈 소스입니다. 또한 스키마에서 자유로운 JSON 문서를 지원하고 HTTP 웹 인터페이스 역시 지원합니다.

> ### Apache Lucene
> 자바 언어로 이루어진 정보 검색 라이브러리 오픈 소스 소프트웨어.
> 전문 검색 색인 및 검색 기능을 필요로 하는 모든 응용 프로그램에 적합하지만 웹 검색 엔진 및 로컬 단일 사이트 검색 구현에서의 유용성으로 널리 알려져 있다.
> 추천 시스템을 구현하는데 사용되곤 한다.
> [출처 - 위키피디아](https://ko.wikipedia.org/wiki/아파치_루씬)

## Logstash

Logstash는 JRuby로 개발된 데이터 수집 엔진입니다.
좀 더 길게 표현하면 다양한 소스로부터 동시에
데이터를 수집, 전환하여 전송할 수 있도록 하는 오픈 소스 데이터 처리 파이프라인이라고 말할 수 있겠네요.

시스템 로그, 웹 사이트 로그, 애플리케이션 서버 로그 등 다양한 형식의 로그 데이터 원본에서 비정형 데이터를 쉽게 수집할 수 있습니다.

Elastic Stack에서는 검색 엔진인 Elasticsearch의 데이터 파이프라인으로써 로그 데이터를 인덱싱하여 전송해주는 역할을 담당합니다.

## Kibana

오픈소스이며 Elastic Search용 데이터 시각화 플러그인

Kibana는 로그와 시계열 분석, 애플리케이션 모니터링, 운영 인텔리전스사용 사례에 사용되는 데이터 시각화 및 탐색 도구입니다.
히스토그램, 선형 그래프, 원형 차트, 열 지도, 내장 지리 공간적 지원과 같은 강력하고 사용하기 쉬운 기능을 제공합니다.
또한 유명 분석 및 검색 엔진인 Elasticsearch와 긴밀하게 통합되어 Kibana는 Elasticsearch에 저장된 데이터를 시각화할 때 기본 선택 사항이 되었습니다.
https://aws.amazon.com/ko/opensearch-service/the-elk-stack/kibana/

Kibana는 Elasticsearch 데이터를 시각화하고 Elastic Stack을 탐색하게 해주는 무료 오픈 소스 인터페이스입니다.
쿼리 작업량 추적부터 앱을 통한 요청 흐름 방식에 대한 이해에 이르기까지 무엇이든 해보세요.
https://www.elastic.co/kr/kibana/

데이터를 시각적으로 탐색하고 실시간으로 분석 할 수 있다.
시각화를 담당하는 HTML + Javascript 엔진이라고 보면 된다.
키바나(Kibana)의 경우 대체 가능한 소프트웨어로 그라파나(Grafana)가 있다. 데이터베이스 관리자가 주로 사용할 법한 기능을 일부 제외하고 사용자 인터페이스(UI) 측면을 강화한 특징이 있다.



보통은 기능 개발을 끝내고선 로그와 시스템 지표를 확인하고 그다음에 튜닝을 하는 방식으로 하게 된다.
요즘엔 애플리케이션의 기반이 되는 서버(혹은 클라이언트)의 성능이 좋기 때문에 더욱더 개발을 끝난 뒤에 성능 테스트의 결과에 따라 서버를 증설할지 로직을 튜닝할지 결정하게 되는데 여기에서도 가장 핵심은 ‘로그’ 와 ‘모니터링’이다.


# Elastic Stack

ELK 방식은 Elastic 홈페이지에 의하면 사실 현재 이름이 바뀌었습니다.
다양한 서비스와 플러그인(데이터 수집을 하는 Beat 등)을 지원하게 되면서 더 이상 머리 글자를 따서 만드는 형식으로는 너무 길어지는 상황이 생겼다.
그렇게 나온 용어가 바로 Elastic Stack 이다.
Elastic Stack은 ELK Stack이 그 다음 단계로 발전한 것입니다.


1. 1개 이상의 수집할 Data 발생 서버에서 beats가 특정 트리거에 의해 logstash로 Data를 전송합니다. 여기서 각 Client서버 마다 Beats가 설치되어 있어야합니다.

2. logstash로 전달 된 Data를 커스터마이징이 가능한 필터를 통해 가공하여 Elasticsearch로 전달 합니다.

3, Elasticsearch로 전달 받은 데이터를 서버(Elasticsearch)에 저장합니다.

4. kibana에서 연동되있는 Elasticsearch에 저장된 데이터 셋을 토대로 시각화를 제공 합니다.


# References

https://www.elastic.co/kr/what-is/elk-stack
https://www.elastic.co/kr/kibana/
https://aws.amazon.com/ko/opensearch-service/the-elk-stack/

https://sharplee7.tistory.com/120
https://velog.io/@jimin3263/series/ELK
https://www.guru99.com/elk-stack-tutorial.html
https://pearlluck.tistory.com/583
https://velog.io/@courage331/ELK
